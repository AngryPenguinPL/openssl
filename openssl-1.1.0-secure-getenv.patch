--- openssl-1.1.0a/crypto/conf/conf_api.c.0036~	2016-09-22 12:14:51.000000000 +0200
+++ openssl-1.1.0a/crypto/conf/conf_api.c	2016-09-22 16:39:58.243665219 +0200
@@ -9,6 +9,8 @@
 
 /* Part of the code in here was originally in conf.c, which is now removed */
 
+/* for secure_getenv */
+#define _GNU_SOURCE
 #include <stdlib.h>
 #include <string.h>
 #include <openssl/conf.h>
@@ -82,7 +84,7 @@ char *_CONF_get_string(const CONF *conf,
             if (v != NULL)
                 return (v->value);
             if (strcmp(section, "ENV") == 0) {
-                p = getenv(name);
+                p = secure_getenv(name);
                 if (p != NULL)
                     return (p);
             }
@@ -95,7 +97,7 @@ char *_CONF_get_string(const CONF *conf,
         else
             return (NULL);
     } else
-        return (getenv(name));
+        return (secure_getenv(name));
 }
 
 static unsigned long conf_value_hash(const CONF_VALUE *v)
--- openssl-1.1.0a/crypto/conf/conf_mod.c.0036~	2016-09-22 12:14:51.000000000 +0200
+++ openssl-1.1.0a/crypto/conf/conf_mod.c	2016-09-22 16:39:58.243665219 +0200
@@ -7,6 +7,8 @@
  * https://www.openssl.org/source/license.html
  */
 
+/* for secure_getenv */
+#define _GNU_SOURCE
 #include <stdio.h>
 #include <ctype.h>
 #include <openssl/crypto.h>
@@ -478,7 +480,7 @@ char *CONF_get1_default_config_file(void
     char *file;
     int len;
 
-    file = getenv("OPENSSL_CONF");
+    file = secure_getenv("OPENSSL_CONF");
     if (file)
         return OPENSSL_strdup(file);
 
--- openssl-1.1.0a/crypto/engine/eng_list.c.0036~	2016-09-22 12:14:52.000000000 +0200
+++ openssl-1.1.0a/crypto/engine/eng_list.c	2016-09-22 16:39:58.243665219 +0200
@@ -13,6 +13,8 @@
  * SUN MICROSYSTEMS, INC., and contributed to the OpenSSL project.
  */
 
+/* for secure_getenv */
+#define _GNU_SOURCE
 #include "eng_int.h"
 
 /*
@@ -322,7 +324,7 @@ ENGINE *ENGINE_by_id(const char *id)
      * Prevent infinite recursion if we're looking for the dynamic engine.
      */
     if (strcmp(id, "dynamic")) {
-        if ((load_dir = getenv("OPENSSL_ENGINES")) == 0)
+        if ((load_dir = secure_getenv("OPENSSL_ENGINES")) == 0)
             load_dir = ENGINESDIR;
         iterator = ENGINE_by_id("dynamic");
         if (!iterator || !ENGINE_ctrl_cmd_string(iterator, "ID", id, 0) ||
--- openssl-1.1.0a/crypto/rand/randfile.c.0036~	2016-09-22 12:14:52.000000000 +0200
+++ openssl-1.1.0a/crypto/rand/randfile.c	2016-09-22 16:40:45.003938946 +0200
@@ -7,6 +7,8 @@
  * https://www.openssl.org/source/license.html
  */
 
+/* for secure_getenv */
+#define _GNU_SOURCE
 #include "internal/cryptlib.h"
 
 #include <errno.h>
@@ -316,14 +318,10 @@ const char *RAND_file_name(char *buf, si
         }
     }
 #else
-    if (OPENSSL_issetugid() != 0) {
+    s = secure_getenv("RANDFILE");
+    if (s == NULL || *s == '\0') {
         use_randfile = 0;
-    } else {
-        s = getenv("RANDFILE");
-        if (s == NULL || *s == '\0') {
-            use_randfile = 0;
-            s = getenv("HOME");
-        }
+        s = secure_getenv("HOME");
     }
 #endif
 #ifdef DEFAULT_HOME
--- openssl-1.1.0a/crypto/x509/by_dir.c.0036~	2016-09-22 12:14:52.000000000 +0200
+++ openssl-1.1.0a/crypto/x509/by_dir.c	2016-09-22 16:39:58.243665219 +0200
@@ -7,6 +7,8 @@
  * https://www.openssl.org/source/license.html
  */
 
+/* for secure_getenv */
+#define _GNU_SOURCE
 #include <stdio.h>
 #include <time.h>
 #include <errno.h>
@@ -80,7 +82,7 @@ static int dir_ctrl(X509_LOOKUP *ctx, in
     switch (cmd) {
     case X509_L_ADD_DIR:
         if (argl == X509_FILETYPE_DEFAULT) {
-            dir = (char *)getenv(X509_get_default_cert_dir_env());
+            dir = (char *)secure_getenv(X509_get_default_cert_dir_env());
             if (dir)
                 ret = add_cert_dir(ld, dir, X509_FILETYPE_PEM);
             else
--- openssl-1.1.0a/crypto/x509/by_file.c.0036~	2016-09-22 12:14:52.000000000 +0200
+++ openssl-1.1.0a/crypto/x509/by_file.c	2016-09-22 16:39:58.243665219 +0200
@@ -7,6 +7,8 @@
  * https://www.openssl.org/source/license.html
  */
 
+/* for secure_getenv */
+#define _GNU_SOURCE
 #include <stdio.h>
 #include <time.h>
 #include <errno.h>
@@ -47,7 +49,7 @@ static int by_file_ctrl(X509_LOOKUP *ctx
     switch (cmd) {
     case X509_L_FILE_LOAD:
         if (argl == X509_FILETYPE_DEFAULT) {
-            file = (char *)getenv(X509_get_default_cert_file_env());
+            file = (char *)secure_getenv(X509_get_default_cert_file_env());
             if (file)
                 ok = (X509_load_cert_crl_file(ctx, file,
                                               X509_FILETYPE_PEM) != 0);
